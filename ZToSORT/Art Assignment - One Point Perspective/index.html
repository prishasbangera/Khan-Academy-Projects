<!DOCTYPE html>
<html>

    <!--Created with the p5.js web editor-->
    <!--Takes long to load-->
    <!--
    
    https://www.khanacademy.org/computer-programming/art-assignment/4730385872142336?width=600
    
    -->
    
    <head>
        <meta charset="utf-8">
        <title>Art Assignment</title>
        <!--p5.js source-->
        <script src="https://cdn.jsdelivr.net/gh/Steffan153/files/p5-ka.js"></script>
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
                background: black;
            }
            canvas {
                position: absolute;
                transform: translate(-50%, -50%);
                top: 50%;
                left: 50%;
            }
        </style>
    </head>

    <body>
        <script type="">
        
            function planetFloor() {
                colorMode(RGB);
                strokeWeight(1);
                loadPixels();
                let xoff = 0,
                    yoff = 0;
                for (let x = 0; x <= width; x++) {
                    for (let y = height / 2; y <= height; y++) {
                        const amt = sin(
                            (yoff - 1 % noise(xoff * 5, yoff * 2) / 2) *
                            map(y, height / 2, height, 30, 15)
                        );
                        let clr = lerpColor(
                            color(237, 96, 252),
                            color(156, 31, 93),
                            amt
                        );
                        clr = lerpColor(
                            clr, color(53, 0, 99),
                            map(y, height / 2, height, 1, 0)
                        );
                        const i = (x+y*width)*4;
                        pixels[i + 0] = red(clr);
                        pixels[i + 1] = green(clr);
                        pixels[i + 2] = blue(clr);
                        yoff += 0.1;
                    }
                    xoff += 0.01;
                    yoff = 0;
                }
                updatePixels();

            }

            function planetFloorShinies() {
                // random tiny shinies near the top ground
                colorMode(RGB);
                randomSeed(16);
                noStroke();
                for (i = 0; i < 700; i++) {
                    let s = random(1, 8),
                        x = random(width),
                        y = randomGaussian(height / 2, height * 0.2);
                    fill(255, 184, 201, 25);
                    // main grad
                    if (y > height / 2) {
                        for (let d = random(5); d > 0; d--) {
                            ellipse(x, y, d + s, d);
                        }
                        // white dot
                        if (y < height / 2 + 40 && s > 2) {
                            fill(217, 255, 255, 185);
                            ellipse(x, y, s * 0.75, s * 0.4);
                        }
                    }
                }
                // grad
                noStroke();
                fill(255, 237, 196, 4);
                for (let i = 0, add = 0; i < 230; i += add, add += 0.03) {
                    rect(vanishPt.x, vanishPt.y, width, i);
                }
            }

            function moon() {

                let r = 100;

                colorMode(RGB);
                noiseSeed(10);
                push();
                translate(width * 0.5, height * 0.5);

                //back rad grad
                noStroke();
                fill(255, 3)
                for (let i = r * 2, add = 0; i < r * 2 + 120; i += add, add += 0.1) {
                    ellipse(0, 0, i);
                }

                let xoff = 0;
                const midClr = color(120, 185, 255);
                for (let x = -r; x < r; x++) {
                    let yoff = 0;
                    for (let y = -r; y < 0; y++) {
                        // const i = (x+width*0.5 + (y+height*0.5)*width)*4;
                        if (dist(x + width * 0.5, y + height / 2, vanishPt.x, vanishPt.y) < r) {
                            const amt = noise(xoff, yoff);
                            if (amt < 0.3) {
                                stroke(lerpColor(
                                    color(87, 32, 250),
                                    midClr,
                                    map(amt, 0, 0.3, 0, 1)), 240);
                            } else {
                                stroke(lerpColor(
                                    midClr,
                                    color(162, 41, 227),
                                    map(amt, 0.3, 1, 0, 1)), 240);
                            }
                            point(x, y);
                            yoff += 0.05;
                        }
                    }
                    xoff += 0.02;
                }


                //front rad grad
                noFill();
                stroke(255, 4);
                for (let i = 0, add = 0; i <= r; i += add, add += 0.1) {
                    strokeWeight(i);
                    ellipse(0, 0, r * 2 - i * 0.5);
                }

                pop();
            }

            function backdrop() {
                randomSeed(1);
                const maxY = height / 2;
                // linear grad
                for (let y = 0; y <= maxY; y++) {
                    stroke(lerpColor(
                        color(9, 0, 46),
                        color(142, 76, 255),
                        map(y, 0, maxY, 0, 1)
                    ));
                    line(0, y, width, y);
                }
                // ellipse texture
                randomSeed(257);
                noStroke();
                colorMode(HSB, 255);
                for (let i = 0; i < 276; i++) {
                    fill(random(255), 214, 255, 10);
                    ellipse(random(width), random(maxY),
                        random(272), random(228));
                }
                // stars
                colorMode(HSB, 255);
                for (let i = 0; i < 900; i++) {
                    // larger
                    const s = random(7);
                    const x = random(width);
                    const y = randomGaussian(0, maxY / 4);
                    stroke(random(100, 200), 105, 255, random(30));
                    for (var j = 0; j < s; j++) {
                        strokeWeight(j);
                        point(x, y);
                    }
                    //smaller
                    strokeWeight(random(3));
                    stroke(255, random(100));
                    point(random(width), random(maxY));
                }
                // spirals   
                randomSeed(24);
                const pts = [
                    [72, 19],
                    [425, 76],
                    [182, 10],
                    [320, 42],
                    [449, 10],
                    [244, 71],
                    [546, 10],
                    [166, 80]
                ];
                const incs = [1.5, 1.6, 1.7];
                for (i = 0; i < pts.length; i++) {
                    push();
                    translate(pts[i][0], pts[i][1]);
                    scale(map(pts[i][1], 0, maxY, 1, 0.4));
                    rotate(random(360));
                    let n1 = random(3, 10),
                        n2 = random(10, 20),
                        inc = incs[~~random(incs.length)];
                    for (let r = 0; r < 360; r += inc) {
                        stroke(random(255), 95, 255, random(90, 100));
                        strokeWeight(random(3));
                        let x = cos(r) * (r / n1);
                        let y = sin(r) * (r / n2);
                        point(x, y);
                    }
                    pop();
                }
            }

            function blobs() {
                randomSeed(51);
                noStroke();
                for (let x = -10; x < width + 10; x += 5) {
                    const s = random(
                        map(abs(x - width / 2), 0, width / 2, 0, 7),
                        map(abs(x - width / 2), 0, width / 2, 0, 25));
                    const n = map(abs(x - width / 2), 0, width / 2, 0, 169) - s;
                    const y = random(-n, n) + height / 2;
                    push();
                    translate(x, y);
                    colorMode(HSB, 255);
                    for (let j = s, sub = 0; j > 0; j -= sub, sub += 0.1) {
                        fill(map(j, 0, s, 60, 20),
                             map(j, 0, s, 39, 244), 255, 18);
                        ellipse(0, 0, j, j);
                    }
                    colorMode(RGB);
                    fill(255, 240, 31, 5);
                    for (j = s, sub = 0; j <= s * 2.6; j += sub, sub += 0.1) { 
                        ellipse(0, 0, j, j) 
                    }
                    pop();
                }
            }

            function walls() {

                colorMode(RGB);
                // floor
                noStroke();
                fill(255, 118);
                triangle(vanishPt.x, vanishPt.y, 0, height, width, height);
                // walls
                fill(255, 16);
                rect(width / 2, height / 2, width, height);

                // trims
                stroke(255, 100);
                strokeWeight(0.5);

                function drawTriangle(scaleX, scaleY, amt, alpha) {
                    alpha = alpha || 10;
                    push();
                    fill(255, alpha);
                    translate(vanishPt.x, vanishPt.y);
                    scale(scaleX, scaleY);
                    triangle(0, 0, -width / 2, -height / 2,
                        -width / 2, amt - height / 2);

                    triangle(0, 0, -width / 2, -height / 2,
                        amt - width / 2, -height / 2);
                    pop();
                }
                let amts = [
                    [600, 13, 0.3],
                    [27, 50, 1]
                ];
                for (let i = 0; i < amts.length; i++) {
                    for (let s = 0; s <= 1; s += amts[i][2]) {
                        drawTriangle(s, s, amts[i][0], amts[i][1]);
                        drawTriangle(s, -s, amts[i][0], amts[i][1]);
                        drawTriangle(-s, s, amts[i][0], amts[i][1]);
                        drawTriangle(-s, -s, amts[i][0], amts[i][1]);
                    }
                }
                // horizontal
                strokeWeight(2);
                for (let y = 0; y <= height; y++) {
                    stroke(217, 243, 250, cos(y / 10) * 5 + 15);
                    line(0, y, vanishPt.x, vanishPt.y);
                    line(width, y, vanishPt.x, vanishPt.y);
                }

            }

            var vanishPt = {
                x: 300,
                y: 200,
                display: function() {
                    stroke(255, 100);
                    strokeWeight(1);
                    line(0, 0, this.x, this.y);
                    line(0, height, this.x, this.y);
                    line(width, 0, this.x, this.y);
                    line(width, height, this.x, this.y);
                    line(0, this.y, width, this.y);
                }
            };
            var queue = [backdrop, moon, planetFloor, planetFloorShinies, blobs, walls];
            var counter = 0;

            function setup() {

                createCanvas(600, 400);
                rectMode(CENTER);
                imageMode(CENTER);
                pixelDensity(1);

                background(0);

            }

            function draw() {
                if (queue[counter]) {
                    queue[counter]();
                    counter++;
                } else {
                    noLoop();
                }
                //draw perspective lines
                // vanishPt.display();
            }
            
        </script>
    </body>

</html>